<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="js/crash_geojson.js"></script>
    <title></title>
</head>
<body>
   <div id="wrapper">
       <div class=container style="display: inline-flex;">
           <div class="left-side" style="width: 600px; height: 400px; margin: 0 auto">
                <div id="bar-chart" style="width: 600px; height: 400px; margin: 0 auto"></div>
           </div>

           <div class="right-side" style="width: 600px; height: 400px; margin: 0 auto">
               <div id="map" style="width: 600px; height: 400px"></div>
           </div>
       </div>
   </div>


   <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
   <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
   <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css' rel='stylesheet' />
   <script src="js/create_map.js"></script>
<script>
$(function () {
    var options = {
        credits: {
            enabled: false
        },
        chart: {
            type: 'column'
        },
        title: {
            text: 'Melbourne Pedestrian Crash Count 2009-2013'
        },
        subtitle: {
            text: 'Source: <a href="https://data.melbourne.vic.gov.au/ ">City of Melbourne open data</a>'
        },
        xAxis: {
            type: 'category',
            labels: {
                rotation: -60,
                style: {
                    fontSize: '12px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Pedestrian Crash Count'
            }
        },
        legend: {
            enabled: false
        },
        tooltip: {
            pointFormat: '<strong>Pedestrian Crash Count: {point.y} </strong>'
        },
        series: [{
            name: 'Pedestrian crash count',
            data: [],
            dataLabels: {
                allowOverlap: true,
                enabled: true,
                rotation: 0,
                color: '#FFFFFF',
                align: 'center',
                format: '{point.y}',
                y: 22, // 5 pixels down from the top
                style: {
                    fontSize: '12px',
                    fontFamily: 'Verdana, sans-serif'
                }
            }
        }],
        plotOptions: {
            series: {
                pointPadding: 0,
                groupPadding: 0.1,
                point: {
                    events: {
                        mouseOver: function () {
                            $(this.series.chart.xAxis[0].labelGroup.element.childNodes[this.x]).css({
                                    'fill': '#7cb5ec',
                                    'font-weight': 'bold'
                            });
                            //this.x start from 0-23 (24 hours)
                           // console.log(this.x);

                            showCurrentCrash(layerArray,this.x);
                        },
                        mouseOut: function () {
                            $(this.series.chart.xAxis[0].labelGroup.element.childNodes[this.x]).css({
                                    'fill': '#606060',
                                    'font-weight': 'normal'
                            });
                            //this.x = 17
                            //console.log("mouseOut");
                            //createAllLayers(layerArray);
                        }
                    }
                }
            }
        }
    };
    $.getJSON('json/mel_ped_crash_count.json', function(data) {
        for (i = 0; i < data.length; i++){
            options.series[0].data.push([data[i].time_period, data[i].crash_count]);
        }

        $('#bar-chart').highcharts(options);
    });

//    $( "#wrapper" ).mouseout(function() {
//      createAllLayers(layerArray);
//    });
});
</script>
</body>
</html>